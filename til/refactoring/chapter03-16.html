<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>03-16. 임시 필드 | wally-wally TIL</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="wally-wally&#39;s TIL">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/wally-wally-til/assets/css/0.styles.5b0b7f0f.css" as="style"><link rel="preload" href="/wally-wally-til/assets/js/app.f5246800.js" as="script"><link rel="preload" href="/wally-wally-til/assets/js/2.fd76ebd9.js" as="script"><link rel="preload" href="/wally-wally-til/assets/js/66.3f31ca88.js" as="script"><link rel="prefetch" href="/wally-wally-til/assets/js/10.d9a95bfe.js"><link rel="prefetch" href="/wally-wally-til/assets/js/11.a2a6e0bb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/12.07ea1bdf.js"><link rel="prefetch" href="/wally-wally-til/assets/js/13.1bfbaa6f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/14.90ad19d6.js"><link rel="prefetch" href="/wally-wally-til/assets/js/15.f50c2694.js"><link rel="prefetch" href="/wally-wally-til/assets/js/16.85e8420c.js"><link rel="prefetch" href="/wally-wally-til/assets/js/17.872b0e5a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/18.f1794982.js"><link rel="prefetch" href="/wally-wally-til/assets/js/19.786141e4.js"><link rel="prefetch" href="/wally-wally-til/assets/js/20.88ff03b1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/21.fd903a51.js"><link rel="prefetch" href="/wally-wally-til/assets/js/22.d215abd1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/23.44ffc4f2.js"><link rel="prefetch" href="/wally-wally-til/assets/js/24.01293f45.js"><link rel="prefetch" href="/wally-wally-til/assets/js/25.3ef63158.js"><link rel="prefetch" href="/wally-wally-til/assets/js/26.a467aa9c.js"><link rel="prefetch" href="/wally-wally-til/assets/js/27.9e7ecb66.js"><link rel="prefetch" href="/wally-wally-til/assets/js/28.2ab87b73.js"><link rel="prefetch" href="/wally-wally-til/assets/js/29.4481ba0f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/3.c603572a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/30.19fd5f37.js"><link rel="prefetch" href="/wally-wally-til/assets/js/31.d5bfcc5a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/32.5ee24aeb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/33.11913056.js"><link rel="prefetch" href="/wally-wally-til/assets/js/34.31af5972.js"><link rel="prefetch" href="/wally-wally-til/assets/js/35.9ae3b57d.js"><link rel="prefetch" href="/wally-wally-til/assets/js/36.39511f04.js"><link rel="prefetch" href="/wally-wally-til/assets/js/37.298faa13.js"><link rel="prefetch" href="/wally-wally-til/assets/js/38.04a5a190.js"><link rel="prefetch" href="/wally-wally-til/assets/js/39.02659111.js"><link rel="prefetch" href="/wally-wally-til/assets/js/4.ed8f2e2d.js"><link rel="prefetch" href="/wally-wally-til/assets/js/40.e5fe29a8.js"><link rel="prefetch" href="/wally-wally-til/assets/js/41.2e0f3c4d.js"><link rel="prefetch" href="/wally-wally-til/assets/js/42.604fb7ae.js"><link rel="prefetch" href="/wally-wally-til/assets/js/43.7be3d9b4.js"><link rel="prefetch" href="/wally-wally-til/assets/js/44.6a25a594.js"><link rel="prefetch" href="/wally-wally-til/assets/js/45.3d5db9fb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/46.f541a5fe.js"><link rel="prefetch" href="/wally-wally-til/assets/js/47.493907b1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/48.8846fba8.js"><link rel="prefetch" href="/wally-wally-til/assets/js/49.180ec634.js"><link rel="prefetch" href="/wally-wally-til/assets/js/5.16508133.js"><link rel="prefetch" href="/wally-wally-til/assets/js/50.43c8c2f2.js"><link rel="prefetch" href="/wally-wally-til/assets/js/51.cf749cf9.js"><link rel="prefetch" href="/wally-wally-til/assets/js/52.99331d67.js"><link rel="prefetch" href="/wally-wally-til/assets/js/53.efc989ab.js"><link rel="prefetch" href="/wally-wally-til/assets/js/54.6d56ccbb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/55.0c06e067.js"><link rel="prefetch" href="/wally-wally-til/assets/js/56.b45e191a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/57.961440e9.js"><link rel="prefetch" href="/wally-wally-til/assets/js/58.a3d99037.js"><link rel="prefetch" href="/wally-wally-til/assets/js/59.55d3c672.js"><link rel="prefetch" href="/wally-wally-til/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/wally-wally-til/assets/js/60.1eb9e815.js"><link rel="prefetch" href="/wally-wally-til/assets/js/61.60cf2957.js"><link rel="prefetch" href="/wally-wally-til/assets/js/62.060bd05f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/63.f005f9ad.js"><link rel="prefetch" href="/wally-wally-til/assets/js/64.a7d460aa.js"><link rel="prefetch" href="/wally-wally-til/assets/js/65.083b5915.js"><link rel="prefetch" href="/wally-wally-til/assets/js/67.affe2987.js"><link rel="prefetch" href="/wally-wally-til/assets/js/68.58b01f3c.js"><link rel="prefetch" href="/wally-wally-til/assets/js/69.c7491bbb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/7.233f38d3.js"><link rel="prefetch" href="/wally-wally-til/assets/js/70.9c9e05e7.js"><link rel="prefetch" href="/wally-wally-til/assets/js/71.67c4633a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/72.66a1fbf9.js"><link rel="prefetch" href="/wally-wally-til/assets/js/73.cc121e7e.js"><link rel="prefetch" href="/wally-wally-til/assets/js/74.b71f297f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/75.24c397b2.js"><link rel="prefetch" href="/wally-wally-til/assets/js/8.f792d4e1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/9.897445a3.js">
    <link rel="stylesheet" href="/wally-wally-til/assets/css/0.styles.5b0b7f0f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wally-wally-til/" class="home-link router-link-active"><img src="/wally-wally-til/logo.png" alt="wally-wally TIL" class="logo"> <span class="site-name can-hide">wally-wally TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wally-wally-til/til/" class="nav-link router-link-active">
  TIL
</a></div><div class="nav-item"><a href="/wally-wally-til/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://wally-wally.kr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  wally-wally
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wally-wally-til/til/" class="nav-link router-link-active">
  TIL
</a></div><div class="nav-item"><a href="/wally-wally-til/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://wally-wally.kr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  wally-wally
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS Deep Dive</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Effective TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Refactoring</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wally-wally-til/til/refactoring/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-01.html" class="sidebar-link">Chapter03-01</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-02.html" class="sidebar-link">Chapter03-02</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-03.html" class="sidebar-link">Chapter03-03</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-04.html" class="sidebar-link">Chapter03-04</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-05.html" class="sidebar-link">Chapter03-05</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-06.html" class="sidebar-link">Chapter03-06</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-07.html" class="sidebar-link">Chapter03-07</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-08.html" class="sidebar-link">Chapter03-08</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-09.html" class="sidebar-link">Chapter03-09</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-10.html" class="sidebar-link">Chapter03-10</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-11.html" class="sidebar-link">Chapter03-11</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-12.html" class="sidebar-link">Chapter03-12</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-13.html" class="sidebar-link">Chapter03-13</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-14.html" class="sidebar-link">Chapter03-14</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-15.html" class="sidebar-link">Chapter03-15</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-16.html" aria-current="page" class="active sidebar-link">Chapter03-16</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wally-wally-til/til/refactoring/chapter03-16.html#intro" class="sidebar-link">✋ Intro</a></li><li class="sidebar-sub-header"><a href="/wally-wally-til/til/refactoring/chapter03-16.html#_1-특이-케이스-추가하기" class="sidebar-link">(1) 특이 케이스 추가하기</a></li></ul></li><li><a href="/wally-wally-til/til/refactoring/chapter03-17.html" class="sidebar-link">Chapter03-17</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-18.html" class="sidebar-link">Chapter03-18</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-19.html" class="sidebar-link">Chapter03-19</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-20.html" class="sidebar-link">Chapter03-20</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-21.html" class="sidebar-link">Chapter03-21</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-22.html" class="sidebar-link">Chapter03-22</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-23.html" class="sidebar-link">Chapter03-23</a></li><li><a href="/wally-wally-til/til/refactoring/chapter03-24.html" class="sidebar-link">Chapter03-24</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Functional Coding</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_03-16-임시-필드"><a href="#_03-16-임시-필드" class="header-anchor">#</a> 03-16. 임시 필드</h1> <br> <h2 id="intro"><a href="#intro" class="header-anchor">#</a> ✋ Intro</h2> <ul><li>간혹 특정 상황에서만 값이 설정되는 필드를 가지는 클래스가 있다.</li> <li>하지만 객체를 가져올 때는 당연히 모든 필드가 채워져 있으리라 기대하는게 보통이지만 쓰이지 않는 것처럼 보이는 임시 필드가 존재한다.</li> <li>이러한 필드들을 발견하면 '<strong>클래스 추출하기</strong>'로 제 살 곳을 찾아주고 그 후 '<strong>함수 옮기기</strong>'로 임시 필드들과 관련된 코드를 모조리 새 클래스에 몰아넣는다.</li> <li>또한, 임시 필드들이 유효한지 확인한 후 동작하는 조건부 로직이 있을 수 있는데, '<strong>특이 케이스 추가하기</strong>'로 필드들이 유효하지 않을 때를 위한 대안 클래스를 만들어서 제거할 수 있다.</li></ul> <hr> <ul><li>책에서는 클래스를 예시로 설명하고 있는데 객체인 경우에도 해당 경우를 생각해볼 수 있을 것 같다.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wally'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>office <span class="token operator">===</span> <span class="token string">'abc.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>member_access_unique_id <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">abc_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>office <span class="token operator">===</span> <span class="token string">'def.go.kr'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>gov_auth_key <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getAuthKey</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_def</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token comment">// 하략</span>
</code></pre></div><ul><li>위 코드와 같이 특정 케이스에 대해서만 고려되는 필드들을 추가하고 관리하는 코드를 종종 볼 수 있다.
<ul><li>변수명이라도 시멘틱하게 잘 지으면 코드를 이어받아서 다른 사람이 작업할 때 그나마 머리를 싸맬 필요가 없을 수 있다.</li> <li>하지만 <code>obj.a</code>, <code>obj.temp_key</code> 와 같이 의미를 파악하기 어려운 네이밍으로 변수명을 지으면 어떤 의미인지 파악하기 어려워 작업하는데 해맬 수도 있다.</li></ul></li> <li>그래서 특정 상황에서만 쓰이는 key 값을 무한으로 증식해서 관리하지 않고 공통으로 사용할 수 있는 변수로 묶어서 관리하고 위 코드의 <code>if</code> 문 처럼 조건식에 걸리지 않는 경우 empty string이나 <code>null</code> 값으로 기본값을 설정하는 방식이 좋을 것 같다.</li></ul> <hr> <br> <h2 id="_1-특이-케이스-추가하기"><a href="#_1-특이-케이스-추가하기" class="header-anchor">#</a> (1) 특이 케이스 추가하기</h2> <ul><li>특수한 경우의 공통 동작은 요소 하나에 모아서 사용하는 <b>특이 케이스 패턴</b>이라는 것이 있는데, 이 때 적용하면 좋은 리팩토링 기법 중 하나이다.</li> <li>특이 케이스 객체에서 단순히 데이터를 읽기만 한다면 반환할 값들을 담은 리터럴 객체 형태로 준비하면 된다.</li> <li>만약 그 이상의 어떤 동작을 수행한다면 필요한 메서드를 담은 객체를 생성하면 된다.</li> <li>특이 케이스 객체는 이를 캡슐화한 클래스가 반환하도록 만들 수도 있고, 변환을 거쳐 데이터 구조에 추가시키는 형태도 될 수 있다.</li> <li>가장 흔한 특이 케이스 패턴으로 널 객체 패턴(Null Object Pattern)이 있다.</li></ul> <hr> <h3 id="널-객체-패턴-null-object-pattern"><a href="#널-객체-패턴-null-object-pattern" class="header-anchor">#</a> ➕ 널 객체 패턴(Null Object Pattern)</h3> <blockquote><p>인터페이스는 구현하지만 아무 일도 하지 않는 객체</p></blockquote> <ul><li>Null 객체 패턴은 GoF의 디자인 패턴 목록에는 없는 패턴이다.</li> <li>하지만 코딩을 하다 보면 자연스럽게 터득해 사용하게 되는 기법이기도 하다.</li> <li>구현의 심플함에 비해 유용하고, 나름의 중요한 의미가 있는 패턴이다.</li> <li>자바에서 흔히 마주칠 수 있는 에러가 <code>NullPointerException</code>이다.
<ul><li>이를 방지하기 위해 <code>if(object!=null)</code> 등의 코드를 활용하게 된다.</li> <li>특정 객체가 존재하지 않는다는 것을 <code>null</code>이아닌 Null Object를 반환하여 <code>NullPointerException</code>을 방지하는 기법이 널 오브젝트 패턴이다.</li></ul></li> <li>주의
<ul><li>이 패턴을 잘못 도입하면 예외나 에러를 탐지하기 어려워지는 경우가 있다.</li> <li>도입했을 때 클래스와 코드가 마구 늘어난다면 이 패턴이 적절하지 않은 상황이거나 잘못 구현한 것이다.</li></ul></li></ul> <p>📄 <b>Reference</b></p> <ul><li>https://johngrib.github.io/wiki/pattern/null-object/</li> <li>https://bb-library.tistory.com/207</li></ul> <hr> <ul><li>리팩토링 적용 예시</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Site</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_customer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 고객 이름</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">billingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 요금제</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">billingPlan</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 요금제 setter</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">paymentHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 납부 이력</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 미확인 고객을 처리해야 하는 클라이언트가 아래와 같이 여러 개 있다고 가정하자.</span>
<span class="token comment">// 고객 이름으로는 '거주자'를 사용하고, 기본 요금제를 청구하고, 연체 기간은 0주로 분류한다.</span>

<span class="token comment">// 클라이언트1</span>
<span class="token keyword">const</span> aCustomer <span class="token operator">=</span> site<span class="token punctuation">.</span>custoner<span class="token punctuation">;</span>
<span class="token keyword">let</span> customerName<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>aCustomer <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> customerName <span class="token operator">=</span> <span class="token string">'거주자'</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> customerName <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트2</span>
<span class="token keyword">const</span> plan <span class="token operator">=</span> <span class="token punctuation">(</span>aCustomer <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> <span class="token operator">?</span> registry<span class="token punctuation">.</span>billingPlans<span class="token punctuation">.</span>basic <span class="token operator">:</span> aCustomer<span class="token punctuation">.</span>billingPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트3</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>aCustomer <span class="token operator">!==</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> aCustomer<span class="token punctuation">.</span>billingPlan <span class="token operator">=</span> newPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트4</span>
<span class="token keyword">const</span> weekDelinquent <span class="token operator">=</span> <span class="token punctuation">(</span>aCustomer <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> aCustomer<span class="token punctuation">.</span>paymentHistory<span class="token punctuation">.</span>weeksDelinquentInLastYear<span class="token punctuation">;</span>
</code></pre></div><ul><li>예시1) 클래스 생성 방식</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 미확인 고객인지를 나타내는 메서드를 고객 클래스에 추가</span>
<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 그 후 미확인 고객 전용 클래스를 만듬</span>
<span class="token keyword">class</span> <span class="token class-name">UnknwonCustomer</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 여러 곳에서 똑같이 수정해야만 하는 코드를 별도 함수로 추출하여 한데 모음</span>
<span class="token comment">// 지금 예에서는 특이 케이스인지 확인하는 코드가 추출 대상임</span>
<span class="token keyword">function</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arg instancof Customer<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>arg <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">잘못된 값과 비교: &lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>arg <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 추출한 함수를 클라이언트 코드에 적용</span>

<span class="token comment">// 클라이언트1</span>
<span class="token keyword">const</span> aCustomer <span class="token operator">=</span> site<span class="token punctuation">.</span>custoner<span class="token punctuation">;</span>
<span class="token keyword">let</span> customerName<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUnknown</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">)</span><span class="token punctuation">)</span> customerName <span class="token operator">=</span> <span class="token string">'거주자'</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> customerName <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트2</span>
<span class="token keyword">const</span> plan <span class="token operator">=</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">)</span> <span class="token operator">?</span> registry<span class="token punctuation">.</span>billingPlans<span class="token punctuation">.</span>basic <span class="token operator">:</span> aCustomer<span class="token punctuation">.</span>billingPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트3</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isUnknown</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">)</span><span class="token punctuation">)</span> aCustomer<span class="token punctuation">.</span>billingPlan <span class="token operator">=</span> newPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트4</span>
<span class="token keyword">const</span> weekDelinquent <span class="token operator">=</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> aCustomer<span class="token punctuation">.</span>paymentHistory<span class="token punctuation">.</span>weeksDelinquentInLastYear<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 특이 케이스일 때 Site 클래스가 UnknownCustomer 객체를 반환하도록 수정</span>

<span class="token keyword">class</span> <span class="token class-name">Site</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_customer <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">UnknownCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_customer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// isUnknown 함수 수정</span>
<span class="token keyword">function</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>arg instancof Customer <span class="token operator">||</span> arg <span class="token keyword">instanceof</span> <span class="token class-name">UnknownCustomer</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">잘못된 값과 비교: &lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> arg<span class="token punctuation">.</span>isUnknown<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 각 클라이언트에서 수행하는 특이 케이스 검사를 일반적인 기본값으로 대체할 수 있다면 이 검사 코드에서 여러 함수를 클래스로 묶기를 적용할 수 있다.</span>
<span class="token comment">// 그러면 조건부 로직이 필요없게 된다.</span>

<span class="token keyword">class</span> <span class="token class-name">UnknwonCustomer</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'거주자'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">get</span> <span class="token function">billingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> registry<span class="token punctuation">.</span>billingPlans<span class="token punctuation">.</span>basic<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">set</span> <span class="token function">billingPlan</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 우선 무시</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">get</span> <span class="token function">paymentHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NullPaymentHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">NullPaymentHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">weeksDelinquentInLastYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 클라이언트1</span>
<span class="token keyword">const</span> aCustomer <span class="token operator">=</span> site<span class="token punctuation">.</span>customer<span class="token punctuation">;</span>
<span class="token keyword">const</span> customerName <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트2 (읽는 경우)</span>
<span class="token keyword">const</span> plan <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>billingPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트3</span>
aCustomer<span class="token punctuation">.</span>billingPlan <span class="token operator">=</span> newPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트4</span>
<span class="token keyword">const</span> weekDelinquent <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>paymentHistory<span class="token punctuation">.</span>weeksDelinquentInLastYear<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 특이 케이스로부터 다른 클라이언트와는 다른 무언가를 원하는 독특한 클라이언트가 있을 수 있다.</span>
<span class="token comment">// ex) 미확인 고객의 이름으로 '거주자'를 사용하는 경우</span>
<span class="token comment">// 이런 경우엔 원래의 특이 케이스 검사 코드를 유지해야 한다.</span>
<span class="token comment">// isUnknown() 함수를 인라인 하고 모든 클라이언트를 수정했다면, 호출하는 곳이 없어진 전역 isUnknown() 함수를 죽은 코드 제거하기로 없애면 된다.</span>

<span class="token keyword">const</span> name <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>isUnknown <span class="token operator">?</span> <span class="token string">'미확인 거주자'</span> <span class="token operator">:</span> aCustomer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><ul><li>예시2) 객체 리터럴 방식
<ul><li>만약 데이터 구조를 읽기만 한다면 클래스 대신 리터럴 객체를 사용해도 된다.</li> <li>리터럴을 아래와 같이 사용하려면 불변으로 만들어야 한다.(<code>freeze()</code> 메서드 이용)</li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">.</span>isUnknown<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createUnknownCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isUnknown</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'거주자'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">billingPlan</span><span class="token operator">:</span> registry<span class="token punctuation">.</span>billingPlans<span class="token punctuation">.</span>basic<span class="token punctuation">,</span>
    <span class="token literal-property property">paymentHistory</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">weeksDelinquentInLastYear</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Site</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_customer <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">createUnknownCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_customer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 클라이언트1</span>
<span class="token keyword">const</span> aCustomer <span class="token operator">=</span> site<span class="token punctuation">.</span>customer<span class="token punctuation">;</span>
<span class="token keyword">const</span> customerName <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트2</span>
<span class="token keyword">const</span> plan <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>billingPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트3</span>
<span class="token keyword">const</span> weekDelinquent <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>paymentHistory<span class="token punctuation">.</span>weeksDelinquentInLastYear<span class="token punctuation">;</span>
</code></pre></div><ul><li>예시3) 변환 함수 방식
<ul><li>변환 단계를 추가하면 같은 아이디어를 레코드에도 적용할 수 있다.</li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> rawSite <span class="token operator">=</span> <span class="token function">acquireSiteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> site <span class="token operator">=</span> <span class="token function">enrichSite</span><span class="token punctuation">(</span>rawSite<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">isUnknown</span><span class="token punctuation">(</span><span class="token parameter">aCustomer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>aCustomer <span class="token operator">===</span> <span class="token string">'미확인 고객'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> aCustomer<span class="token punctuation">.</span>isUnknown<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">enrichSite</span><span class="token punctuation">(</span><span class="token parameter">aSite</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>aSite<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> unknownCustomer <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isUnknown</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'거주자'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">billingPlan</span><span class="token operator">:</span> registry<span class="token punctuation">.</span>billingPlans<span class="token punctuation">.</span>basic<span class="token punctuation">,</span>
    <span class="token literal-property property">paymentHistory</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">weekDelinquentInLastYear</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUnknown</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>customer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span>customer <span class="token operator">=</span> unknownCustomer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span>customer<span class="token punctuation">.</span>isUnknown <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 클라이언트1</span>
<span class="token keyword">const</span> aCustomer <span class="token operator">=</span> site<span class="token punctuation">.</span>customer<span class="token punctuation">;</span>
<span class="token comment">// 수 많은 코드 ...</span>
<span class="token keyword">const</span> customerName <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트2</span>
<span class="token keyword">const</span> plan <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>billingPlan<span class="token punctuation">;</span>

<span class="token comment">// 클라이언트3</span>
<span class="token keyword">const</span> weeksDelinquent <span class="token operator">=</span> aCustomer<span class="token punctuation">.</span>paymentHistory<span class="token punctuation">.</span>weeksDelinquentInLastYear<span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wally-wally-til/til/refactoring/chapter03-15.html" class="prev">
        Chapter03-15
      </a></span> <span class="next"><a href="/wally-wally-til/til/refactoring/chapter03-17.html">
        Chapter03-17
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/wally-wally-til/assets/js/app.f5246800.js" defer></script><script src="/wally-wally-til/assets/js/2.fd76ebd9.js" defer></script><script src="/wally-wally-til/assets/js/66.3f31ca88.js" defer></script>
  </body>
</html>
