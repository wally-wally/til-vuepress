<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter13. 함수형 도구 체이닝 | wally-wally TIL</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="wally-wally&#39;s TIL">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/wally-wally-til/assets/css/0.styles.5b0b7f0f.css" as="style"><link rel="preload" href="/wally-wally-til/assets/js/app.f5246800.js" as="script"><link rel="preload" href="/wally-wally-til/assets/js/2.fd76ebd9.js" as="script"><link rel="preload" href="/wally-wally-til/assets/js/29.4481ba0f.js" as="script"><link rel="prefetch" href="/wally-wally-til/assets/js/10.d9a95bfe.js"><link rel="prefetch" href="/wally-wally-til/assets/js/11.a2a6e0bb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/12.07ea1bdf.js"><link rel="prefetch" href="/wally-wally-til/assets/js/13.1bfbaa6f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/14.90ad19d6.js"><link rel="prefetch" href="/wally-wally-til/assets/js/15.f50c2694.js"><link rel="prefetch" href="/wally-wally-til/assets/js/16.85e8420c.js"><link rel="prefetch" href="/wally-wally-til/assets/js/17.872b0e5a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/18.f1794982.js"><link rel="prefetch" href="/wally-wally-til/assets/js/19.786141e4.js"><link rel="prefetch" href="/wally-wally-til/assets/js/20.88ff03b1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/21.fd903a51.js"><link rel="prefetch" href="/wally-wally-til/assets/js/22.d215abd1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/23.44ffc4f2.js"><link rel="prefetch" href="/wally-wally-til/assets/js/24.01293f45.js"><link rel="prefetch" href="/wally-wally-til/assets/js/25.3ef63158.js"><link rel="prefetch" href="/wally-wally-til/assets/js/26.a467aa9c.js"><link rel="prefetch" href="/wally-wally-til/assets/js/27.9e7ecb66.js"><link rel="prefetch" href="/wally-wally-til/assets/js/28.2ab87b73.js"><link rel="prefetch" href="/wally-wally-til/assets/js/3.c603572a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/30.19fd5f37.js"><link rel="prefetch" href="/wally-wally-til/assets/js/31.d5bfcc5a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/32.5ee24aeb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/33.11913056.js"><link rel="prefetch" href="/wally-wally-til/assets/js/34.31af5972.js"><link rel="prefetch" href="/wally-wally-til/assets/js/35.9ae3b57d.js"><link rel="prefetch" href="/wally-wally-til/assets/js/36.39511f04.js"><link rel="prefetch" href="/wally-wally-til/assets/js/37.298faa13.js"><link rel="prefetch" href="/wally-wally-til/assets/js/38.04a5a190.js"><link rel="prefetch" href="/wally-wally-til/assets/js/39.02659111.js"><link rel="prefetch" href="/wally-wally-til/assets/js/4.ed8f2e2d.js"><link rel="prefetch" href="/wally-wally-til/assets/js/40.e5fe29a8.js"><link rel="prefetch" href="/wally-wally-til/assets/js/41.2e0f3c4d.js"><link rel="prefetch" href="/wally-wally-til/assets/js/42.604fb7ae.js"><link rel="prefetch" href="/wally-wally-til/assets/js/43.7be3d9b4.js"><link rel="prefetch" href="/wally-wally-til/assets/js/44.6a25a594.js"><link rel="prefetch" href="/wally-wally-til/assets/js/45.3d5db9fb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/46.f541a5fe.js"><link rel="prefetch" href="/wally-wally-til/assets/js/47.493907b1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/48.8846fba8.js"><link rel="prefetch" href="/wally-wally-til/assets/js/49.180ec634.js"><link rel="prefetch" href="/wally-wally-til/assets/js/5.16508133.js"><link rel="prefetch" href="/wally-wally-til/assets/js/50.43c8c2f2.js"><link rel="prefetch" href="/wally-wally-til/assets/js/51.cf749cf9.js"><link rel="prefetch" href="/wally-wally-til/assets/js/52.99331d67.js"><link rel="prefetch" href="/wally-wally-til/assets/js/53.efc989ab.js"><link rel="prefetch" href="/wally-wally-til/assets/js/54.6d56ccbb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/55.0c06e067.js"><link rel="prefetch" href="/wally-wally-til/assets/js/56.b45e191a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/57.961440e9.js"><link rel="prefetch" href="/wally-wally-til/assets/js/58.a3d99037.js"><link rel="prefetch" href="/wally-wally-til/assets/js/59.55d3c672.js"><link rel="prefetch" href="/wally-wally-til/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/wally-wally-til/assets/js/60.1eb9e815.js"><link rel="prefetch" href="/wally-wally-til/assets/js/61.60cf2957.js"><link rel="prefetch" href="/wally-wally-til/assets/js/62.060bd05f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/63.f005f9ad.js"><link rel="prefetch" href="/wally-wally-til/assets/js/64.a7d460aa.js"><link rel="prefetch" href="/wally-wally-til/assets/js/65.083b5915.js"><link rel="prefetch" href="/wally-wally-til/assets/js/66.3f31ca88.js"><link rel="prefetch" href="/wally-wally-til/assets/js/67.affe2987.js"><link rel="prefetch" href="/wally-wally-til/assets/js/68.58b01f3c.js"><link rel="prefetch" href="/wally-wally-til/assets/js/69.c7491bbb.js"><link rel="prefetch" href="/wally-wally-til/assets/js/7.233f38d3.js"><link rel="prefetch" href="/wally-wally-til/assets/js/70.9c9e05e7.js"><link rel="prefetch" href="/wally-wally-til/assets/js/71.67c4633a.js"><link rel="prefetch" href="/wally-wally-til/assets/js/72.66a1fbf9.js"><link rel="prefetch" href="/wally-wally-til/assets/js/73.cc121e7e.js"><link rel="prefetch" href="/wally-wally-til/assets/js/74.b71f297f.js"><link rel="prefetch" href="/wally-wally-til/assets/js/75.24c397b2.js"><link rel="prefetch" href="/wally-wally-til/assets/js/8.f792d4e1.js"><link rel="prefetch" href="/wally-wally-til/assets/js/9.897445a3.js">
    <link rel="stylesheet" href="/wally-wally-til/assets/css/0.styles.5b0b7f0f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wally-wally-til/" class="home-link router-link-active"><img src="/wally-wally-til/logo.png" alt="wally-wally TIL" class="logo"> <span class="site-name can-hide">wally-wally TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wally-wally-til/til/" class="nav-link router-link-active">
  TIL
</a></div><div class="nav-item"><a href="/wally-wally-til/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://wally-wally.kr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  wally-wally
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wally-wally-til/til/" class="nav-link router-link-active">
  TIL
</a></div><div class="nav-item"><a href="/wally-wally-til/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://wally-wally.kr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  wally-wally
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS Deep Dive</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Effective TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Refactoring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Functional Coding</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wally-wally-til/til/functional-coding/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter01.html" class="sidebar-link">Chapter01</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter02.html" class="sidebar-link">Chapter02</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter03.html" class="sidebar-link">Chapter03</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter04.html" class="sidebar-link">Chapter04</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter05.html" class="sidebar-link">Chapter05</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter06.html" class="sidebar-link">Chapter06</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter13.html" aria-current="page" class="active sidebar-link">Chapter13</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wally-wally-til/til/functional-coding/chapter13.html#_1-reduce-maxkey-함수-적용" class="sidebar-link">1. reduce, maxKey 함수 적용</a></li><li class="sidebar-sub-header"><a href="/wally-wally-til/til/functional-coding/chapter13.html#_2-체인을-명확하게-만들기" class="sidebar-link">2. 체인을 명확하게 만들기</a></li><li class="sidebar-sub-header"><a href="/wally-wally-til/til/functional-coding/chapter13.html#_3-스트림-결합-stream-fusion" class="sidebar-link">3. 스트림 결합(stream fusion)</a></li><li class="sidebar-sub-header"><a href="/wally-wally-til/til/functional-coding/chapter13.html#_4-반복문을-함수형-도구로-리팩터링하기" class="sidebar-link">4. 반복문을 함수형 도구로 리팩터링하기</a></li><li class="sidebar-sub-header"><a href="/wally-wally-til/til/functional-coding/chapter13.html#_5-reduce-우아하게-사용하기" class="sidebar-link">5. reduce() 우아하게 사용하기</a></li></ul></li><li><a href="/wally-wally-til/til/functional-coding/chapter14.html" class="sidebar-link">Chapter14</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter15.html" class="sidebar-link">Chapter15</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter16.html" class="sidebar-link">Chapter16</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter17.html" class="sidebar-link">Chapter17</a></li><li><a href="/wally-wally-til/til/functional-coding/chapter18.html" class="sidebar-link">Chapter18</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter13-함수형-도구-체이닝"><a href="#chapter13-함수형-도구-체이닝" class="header-anchor">#</a> Chapter13. 함수형 도구 체이닝</h1> <br> <h2 id="_1-reduce-maxkey-함수-적용"><a href="#_1-reduce-maxkey-함수-적용" class="header-anchor">#</a> 1. <code>reduce</code>, <code>maxKey</code> 함수 적용</h2> <ul><li>before</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">biggestPurchasesBestCustomers</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> bestCustomers <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> customer<span class="token punctuation">.</span>purchases<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">var</span> biggestPurchases <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>bestCustomers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reduce</span><span class="token punctuation">(</span>customer<span class="token punctuation">.</span>purchases<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">biggestSoFar<span class="token punctuation">,</span> purchase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>biggestSoFar<span class="token punctuation">.</span>total <span class="token operator">&gt;</span> purchase<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> biggestSoFar<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> purchase<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">return</span> biggestPurchases<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>after
<ul><li>위 코드보다 조금 개선되었지만 아직 코드에 중첩된 리턴 구문이 있는 콜백이 있다.</li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// maxKey 함수의 세 번째 인자로 어떤 값을 비교할지 콜백 function으로 전달한다.</span>
<span class="token keyword">function</span> <span class="token function">maxKey</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> init<span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">reduce</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> init<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">biggestSoFar<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>biggestSoFar<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> biggestSoFar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> element<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">biggestPurchasesBestCustomers</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> bestCustomers <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> customer<span class="token punctuation">.</span>purchases<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">var</span> biggestPurchases <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>bestCustomers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">maxKey</span><span class="token punctuation">(</span>customer<span class="token punctuation">.</span>purchases<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">purchase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> purchase<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">return</span> biggestPurchases<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>maxKey()</code> 함수로 <code>max()</code> 함수를 만들 수 있다.
<ul><li><code>maxKey()</code> 는 비교하는 값을 자유롭게 선택해서 최댓값을 구할 수 있지만, <code>max()</code>는 값을 직접 비교해야 한다.</li> <li>호출 그래프상에서 <code>maxKey()</code> 가 <code>max()</code> 보다 아래 위치한다.
<ul><li><code>maxKey()</code> 는 <code>max()</code> 보다 더 일반적인 함수다.</li> <li><code>max()</code> 는 <code>maxKey()</code> 의 특별한 버전이라고 볼 수 있다.</li></ul></li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// maxKey 함수로 max 함수 만들기</span>
<span class="token comment">// 아래처럼 인자로 받은 값을 그대로 리턴하는 함수를 항등 함수(identify function)라고 한다.</span>
<span class="token keyword">function</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">maxKey</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> init<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h2 id="_2-체인을-명확하게-만들기"><a href="#_2-체인을-명확하게-만들기" class="header-anchor">#</a> 2. 체인을 명확하게 만들기</h2> <blockquote><p><strong>체이닝(chaining)</strong></p> <p>단계들을 조합해 하나의 쿼리로 만드는 것으로 여러 단계를 하나로 조합하는 것을 말한다.</p></blockquote> <h3 id="_1-단계에-이름-붙이기"><a href="#_1-단계에-이름-붙이기" class="header-anchor">#</a> (1) 단계에 이름 붙이기</h3> <ul><li>각 단계의 고차 함수를 빼내 이름을 붙인다.</li> <li>각 단계에 이름을 붙이면 훨씬 명확해지고 각 단계에 숨어 있던 두 함수의 구현도 알아보기 쉽다.</li> <li>하지만 <b>인라인으로 정의된 콜백 함수는 재사용할 수 없는 문제가 있다.</b></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">biggestPurchasesBestCustomers</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> bestCustomers <span class="token operator">=</span> <span class="token function">selectBestCustomers</span><span class="token punctuation">(</span>customers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> biggestPurchases <span class="token operator">=</span> <span class="token function">getBiggestPurchases</span><span class="token punctuation">(</span>bestCustomers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> biggestPurchases<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">selectBestCustomers</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">filter</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> customer<span class="token punctuation">.</span>purchases<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getBiggestPurchases</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">map</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> getBiggestPurchase<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getBiggestPurchase</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">maxKey</span><span class="token punctuation">(</span>customer<span class="token punctuation">.</span>purchases<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">purchase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> purchase<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h3 id="_2-콜백에-이름-붙이기"><a href="#_2-콜백에-이름-붙이기" class="header-anchor">#</a> (2) 콜백에 이름 붙이기</h3> <ul><li>콜백을 빼내고 이름을 붙여 <b>재사용할 수 있는 함수로 만든다.</b></li> <li><b>호출 그래프의 아래쪽에 위치</b>하므로 재사용하기 좋은 코드라는 것을 알 수 있다.</li> <li>그리고 직관적으로 더 재사용하기 좋은 코드처럼 생겼다.</li> <li>일반적으로 이 방법이 더 명확하다.</li> <li>고차 함수를 그대로 쓰는 첫 번째 방법보다 이름을 붙인 두 번째 방법이 재사용하기도 더 좋다.</li> <li>인라인 대신 이름을 붙여 콜백을 사용하면 단계가 중첩되는 것도 막을 수 있다.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">biggestPurchasesBestCustomers</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> bestCustomers <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> isGoodCustomer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> biggestPurchases <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>bestCustomers<span class="token punctuation">,</span> getBiggestPurchase<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> biggestPurchases<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isGoodCustomer</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> customer<span class="token punctuation">.</span>purchases<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getBiggestPurchase</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">mapKey</span><span class="token punctuation">(</span>customers<span class="token punctuation">.</span>purchases<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> getPurchaseToal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPurchaseToal</span><span class="token punctuation">(</span><span class="token parameter">purchase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> purchase<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h2 id="_3-스트림-결합-stream-fusion"><a href="#_3-스트림-결합-stream-fusion" class="header-anchor">#</a> 3. 스트림 결합(stream fusion)</h2> <h3 id="_1-스트림-결합-개념"><a href="#_1-스트림-결합-개념" class="header-anchor">#</a> (1) 스트림 결합 개념</h3> <ul><li><code>map()</code>, <code>filter()</code>, <code>reduce()</code> 체인을 최적화하는 것을 <b>스트림 결합</b>이라고 한다.</li> <li><code>filter()</code>와 <code>map()</code>은 모두 새로운 배열을 만드는데 함수가 호출될 때마다 새로운 배열이 생겨 크기가 클 수도 있고 비효율적이라고 생각할 수 있다.
<ul><li>하지만 대부분 문제가 되지 않는다.</li> <li>만들어진 배열이 배열이 필요 없을 때 가비지 컬렉터가 빠르게 처리하기 때문이고 현대 가비지 컬렉터를 매우 빠르다.</li></ul></li> <li>이 방법의 제일 큰 목적은 <b>'최적화'</b>이다.
<ul><li>병목이 생겼을 때만 쓰는 것이 좋고 대부분의 경우에는 여러 단계를 사용하는 것이 더 명확하고 읽기 쉽다.</li></ul></li></ul> <br> <h3 id="_2-스트림-결합-적용"><a href="#_2-스트림-결합-적용" class="header-anchor">#</a> (2) 스트림 결합 적용</h3> <ul><li><code>map()</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// before</span>
<span class="token comment">// 값 하나에 map() 두 번 사용</span>
<span class="token keyword">var</span> names <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> getFullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> nameLengths <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> stringLength<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// after</span>
<span class="token comment">// map()을 한 번 사용해도 같다.</span>
<span class="token comment">// 이 코드가 가비지 컬렉션이 필요 없다.</span>
<span class="token keyword">var</span> nameLengths <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">stringLength</span><span class="token punctuation">(</span><span class="token function">getFullName</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>filter()</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// before</span>
<span class="token comment">// 값 하나에 filter() 두 번 사용</span>
<span class="token keyword">var</span> goodCustomers <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> isGoodCustomer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> withAddresses <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>goodCustomers<span class="token punctuation">,</span> hasAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// after</span>
<span class="token comment">// filter()을 한 번 사용해도 같다.</span>
<span class="token comment">// 이 코드가 가비지 컬렉션을 적게 한다.</span>
<span class="token keyword">var</span> withAddresses <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>customers<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">isGoodCustomer</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasAddress</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>reduce()</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// before</span>
<span class="token comment">// map() 다음에 reduce()를 사용</span>
<span class="token keyword">var</span> purchaseTotals <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>purchases<span class="token punctuation">,</span> getPurchaseTotal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> purchaseSum <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span>purchaseTotals<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> plus<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// after</span>
<span class="token comment">// reduce()를 한 번 사용해도 같다.</span>
<span class="token comment">// map()을 사용하지 않았기 때문에 가비지 컬렉션할 중간 배열을 만들지 않았다.</span>
<span class="token keyword">var</span> purchaseSum <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span>purchases<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> purchase</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> total <span class="token operator">+</span> <span class="token function">getPurchaseTotal</span><span class="token punctuation">(</span>purchase<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><br> <h2 id="_4-반복문을-함수형-도구로-리팩터링하기"><a href="#_4-반복문을-함수형-도구로-리팩터링하기" class="header-anchor">#</a> 4. 반복문을 함수형 도구로 리팩터링하기</h2> <blockquote><p>리팩터링할 코드</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> window <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> w <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> w <span class="token operator">&lt;</span> window<span class="token punctuation">;</span> w <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> idx <span class="token operator">=</span> i <span class="token operator">+</span> w<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum <span class="token operator">+=</span> array<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  answer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sum <span class="token operator">/</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h3 id="_1-데이터-만들기"><a href="#_1-데이터-만들기" class="header-anchor">#</a> (1) 데이터 만들기</h3> <ul><li>어떤 값에 <code>map()</code>, <code>filter()</code>를 단계적으로 사용하면 중간에 배열이 생기고 없어지는데 <code>for</code> 반복문을 사용할 때는 처리할 모든 값이 배열이 들어있지 않아도 된다.</li> <li>첫 번째 팁은 데이터를 배열에 넣으면 함수형 도구를 쓸 수 있다.</li> <li>위 코드에서 안쪽에 있는 반복문을 개선해보자.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> subArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> w <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> w <span class="token operator">&lt;</span> subArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> w <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> subArray<span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">;</span>
    count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  answer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sum <span class="token operator">/</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h3 id="_2-한-번에-전체-배열을-조작하기"><a href="#_2-한-번에-전체-배열을-조작하기" class="header-anchor">#</a> (2) 한 번에 전체 배열을 조작하기</h3> <ul><li>하위 배열을 만들었기 때문에 일부 배열이 아닌 배열 전체를 반복할 수 있다.</li> <li><code>map()</code>, <code>filter()</code>, <code>reduce()</code> 는 배열 전체에 동작하기 때문에 이제 이런 함수형 도구를 쓸 수 있다.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> subArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>
  answer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">average</span><span class="token punctuation">(</span>subArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h3 id="_3-작은-단계로-나누기"><a href="#_3-작은-단계로-나누기" class="header-anchor">#</a> (3) 작은 단계로 나누기</h3> <ul><li>하지만 현재까지의 코드를 보면 배열의 항목을 도는 것이 아닌 <b>인덱스</b>를 가지고 반복해야 하는 문제가 있다.</li> <li>인덱스로 반복하는 코드를 한 단계로 만들기 어렵거나 어쩌면 불가능할 수도 있다.</li> <li>그래서 더 작은 단계로 나눠야 한다.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> indices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  indices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> window <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>indices<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> subArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>
  answer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">average</span><span class="token punctuation">(</span>subArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>map()</code> 콜백 안에서 두 가지 일을 하고 있어 두 단계로 나눈다.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> indices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  indices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> window <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> windows <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>indices<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>windows<span class="token punctuation">,</span> average<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>마지막으로 남은 건 인덱스 배열을 만드는 코드를 빼내 유용한 함수로 정의하는 일이다.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 재사용 가능한 추가 도구 생성</span>
<span class="token keyword">function</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> window <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> indices <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> array<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 단계1. 인덱스 배열 생성</span>
<span class="token keyword">var</span> windows <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>indices<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 단계2. 하위 배열 만들기</span>
  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>windows<span class="token punctuation">,</span> average<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 단계3. 평균 계산하기</span>
</code></pre></div><br> <h3 id="체이닝-팁-요약"><a href="#체이닝-팁-요약" class="header-anchor">#</a> 📌 체이닝 팁 요약</h3> <h4 id="데이터-만들기"><a href="#데이터-만들기" class="header-anchor">#</a> 📍 데이터 만들기</h4> <ul><li>함수형 도구는 배열 전체를 다룰 때 잘 동작한다.</li> <li>배열 일부에 대해 동작하는 반복문이 있다면 배열 일부를 새로운 배열로 나눌 수 있다.</li> <li>그리고 <code>map()</code>, <code>filter()</code>, <code>reduce()</code> 같은 함수형 도구를 사용하면 작업을 줄일 수 있다.</li></ul> <h4 id="배열-전체를-다루기"><a href="#배열-전체를-다루기" class="header-anchor">#</a> 📍 배열 전체를 다루기</h4> <ul><li>반복문 대신에 전체 배열을 한 번에 처리할 수 있을지 생각해보자.</li> <li><code>map()</code>은 모든 항목을 변환하고 <code>filter()</code>는 항목을 없애거나 유지한다.</li> <li>그리고 <code>reduce()</code>는 항목을 하나로 합친다.</li> <li>과감하게 배열 전체를 처리해보자.</li></ul> <h4 id="작은-단계로-나누기"><a href="#작은-단계로-나누기" class="header-anchor">#</a> 📍 작은 단계로 나누기</h4> <ul><li>알고리즘이 한 번에 너무 많은 일을 한다고 생각된다면 직관에 반하지만 두 개 이상의 단계로 나눠보자.</li></ul> <h4 id="추가-조건문을-filter-로-바꾸기"><a href="#추가-조건문을-filter-로-바꾸기" class="header-anchor">#</a> 📍 [추가] 조건문을 <code>filter()</code>로 바꾸기</h4> <ul><li>반복문 안에 있는 조건문은 항목을 건너뛰기 위해 사용하는 경우가 있다.</li> <li>앞 단계에서 <code>filter()</code>를 사용해 거를 수 있다.</li></ul> <h4 id="추가-유용한-함수로-추출하기"><a href="#추가-유용한-함수로-추출하기" class="header-anchor">#</a> 📍 [추가] 유용한 함수로 추출하기</h4> <ul><li><code>map()</code>, <code>filter()</code>, <code>reduce()</code> 는 함수형 도구의 전부가 아니다.</li> <li>자주 사용하는 함수형 도구일 뿐 얼마든지 더 추가할 수 있다.</li></ul> <h4 id="추가-개선을-위해-실험하기"><a href="#추가-개선을-위해-실험하기" class="header-anchor">#</a> 📍 [추가] 개선을 위해 실험하기</h4> <ul><li>좋은 방법을 찾기 위해 함수형 도구를 새로운 방법으로 다양하게 조합하며 시도하고 연습해보자.</li></ul> <h3 id="체이닝-디버깅-팁"><a href="#체이닝-디버깅-팁" class="header-anchor">#</a> 📌 체이닝 디버깅 팁</h3> <h4 id="구체적인-것을-유지하기"><a href="#구체적인-것을-유지하기" class="header-anchor">#</a> 📍 구체적인 것을 유지하기</h4> <ul><li>파이프라인 단계가 많으면 잊어버리기 쉬우므로 각 단계에서 어떤 것을 하고 있는지 알기 쉽게 이름을 잘 지어야 한다.</li></ul> <h4 id="출력해보기"><a href="#출력해보기" class="header-anchor">#</a> 📍 출력해보기</h4> <ul><li>각 단계 사이에 <code>console.log</code> 혹은 <code>print</code> 문으로 코드를 돌려 예상한 대로 동작하는지 출력하며 확인해보자</li></ul> <h4 id="타입을-따라가-보기"><a href="#타입을-따라가-보기" class="header-anchor">#</a> 📍 타입을 따라가 보기</h4> <ul><li>타입스크립트와 같은 정적 타입 언어를 사용하면 IDE에서 콜백 함수의 인자나 리턴 값이 어떤 타입인지 자동 추론해서 보여준다.</li> <li>이 기능을 잘 활용하면 원하는 결과가 잘 도출되는지 확인하는데 유용하다.</li></ul> <br> <h2 id="_5-reduce-우아하게-사용하기"><a href="#_5-reduce-우아하게-사용하기" class="header-anchor">#</a> 5. <code>reduce()</code> 우아하게 사용하기</h2> <blockquote><p><code>reduce()</code>를 이용하여 새로운 값을 만들 수 있다.</p></blockquote> <ul><li>로그 데이터를 이용하여 새로운 장바구니 데이터 만들기</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> itemsAdded <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'shirt'</span><span class="token punctuation">,</span> <span class="token string">'shoes'</span><span class="token punctuation">,</span> <span class="token string">'shirt'</span><span class="token punctuation">,</span> <span class="token string">'socks'</span><span class="token punctuation">,</span> <span class="token string">'hat'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> shoppingCart <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span>itemsAdded<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> addOne<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">addOne</span><span class="token punctuation">(</span><span class="token parameter">cart<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cart<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">add_item</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> item<span class="token punctuation">,</span> <span class="token literal-property property">quantity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token function">priceLookup</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> quantity <span class="token operator">=</span> cart<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span>quantity<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">setFieldByName</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">,</span> quantity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>만약 위 상황에서 제품을 추가하거나 삭제하는 것을 모두 지원하려면?
<ul><li>아래와 같이 고객이 제품을 추가했는지 삭제했는지 알려주는 값과 제품에 대한 값을 함께 기록하면 고객이 제품을 삭제한 경우도 처리할 수 있다.</li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> itemOps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'shirt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'shoes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'remove'</span><span class="token punctuation">,</span> <span class="token string">'shirt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'socks'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'hat'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> shoppingCart <span class="token operator">=</span> <span class="token function">reduce</span> <span class="token punctuation">(</span>itemOps<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cart<span class="token punctuation">,</span> itemOp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> op <span class="token operator">=</span> itemOp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> item <span class="token operator">=</span> itemOp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>op <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">addOne</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">if</span> <span class="token punctuation">(</span>op <span class="token operator">===</span> <span class="token string">'remove'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">removeOne</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">removeOne</span><span class="token punctuation">(</span><span class="token parameter">cart<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cart<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cart<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">var</span> quantity <span class="token operator">=</span> cart<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span>quantity<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>quantity <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">remove_item_by_name</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">setFieldByName</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">,</span> quantity <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위 코드에서 중요한 기술은 인자를 데이터로 표현했다는 점이다.
<ul><li>배열에 동작 이름과 제품 이름인 인자를 넣어 동작을 완전한 데이터로 표현했다.</li></ul></li> <li>인자를 데이터로 만들면 함수형 도구를 체이닝하기 좋다.
<ul><li>체이닝을 할 때 리턴할 데이터를 다음 단계의 인자처럼 쓸 수 있도록 만들어보자.</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wally-wally-til/til/functional-coding/chapter06.html" class="prev">
        Chapter06
      </a></span> <span class="next"><a href="/wally-wally-til/til/functional-coding/chapter14.html">
        Chapter14
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/wally-wally-til/assets/js/app.f5246800.js" defer></script><script src="/wally-wally-til/assets/js/2.fd76ebd9.js" defer></script><script src="/wally-wally-til/assets/js/29.4481ba0f.js" defer></script>
  </body>
</html>
